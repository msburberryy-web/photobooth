<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Amore Wedding Photobooth</title>
  <style>
    /* ===== Improved Stylish / Soft-UI CSS ===== */
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #ececec;
      padding: 20px;
      color: #333;
      min-height: 100vh;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h2 {
      margin-bottom: 20px;
      color: #c96c4c;
      font-size: 32px;
      text-shadow: 1px 1px 4px rgba(0,0,0,0.1);
    }

    .card {
      background: #e0e0e0;
      border-radius: 20px;
      box-shadow: 8px 8px 16px rgba(0,0,0,0.1), -8px -8px 16px rgba(255,255,255,0.7);
      padding: 30px;
      margin: 20px 0;
      width: 100%;
      max-width: 520px;
      transition: box-shadow 0.3s ease;
    }

    .card:hover {
      box-shadow: 12px 12px 24px rgba(0,0,0,0.15), -12px -12px 24px rgba(255,255,255,0.8);
    }

    input[type="file"], select {
      padding: 14px;
      border-radius: 12px;
      border: none;
      background: #e0e0e0;
      box-shadow: inset 4px 4px 8px rgba(0,0,0,0.1), inset -4px -4px 8px rgba(255,255,255,0.7);
      margin-top: 15px;
      width: 85%;
      font-size: 16px;
      outline: none;
      transition: box-shadow 0.3s ease;
    }

    input[type="file"]:hover, select:hover {
      box-shadow: inset 2px 2px 6px rgba(0,0,0,0.1), inset -2px -2px 6px rgba(255,255,255,0.7);
    }

    #templatePreviewImg {
      max-width: 300px;
      border-radius: 15px;
      margin-top: 15px;
      box-shadow: 4px 4px 12px rgba(0,0,0,0.1), -4px -4px 12px rgba(255,255,255,0.8);
    }

    #videoWrapper {
      position: relative;
      width: 100%;
      max-width: 480px;
      margin: 20px auto;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 8px 8px 20px rgba(0,0,0,0.15), -8px -8px 20px rgba(255,255,255,0.8);
    }

    video, #overlayCanvas {
      width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
    }

    #countdown {
      font-size: 72px;
      font-weight: bold;
      color: #ff4c4c;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      text-shadow: 2px 2px 10px rgba(0,0,0,0.3);
    }

    .photoPreview {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }

    .photoPreview img {
      width: 140px;
      height: 105px;
      object-fit: cover;
      border-radius: 12px;
      box-shadow: 4px 4px 12px rgba(0,0,0,0.1), -4px -4px 12px rgba(255,255,255,0.8);
      transition: transform 0.3s;
    }

    .photoPreview img:hover {
      transform: scale(1.05);
    }

    .highlight-btn {
      padding: 16px 32px;
      font-size: 17px;
      border: none;
      border-radius: 18px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      background: linear-gradient(135deg, #c96c4c, #ff7f5f);
      box-shadow: 6px 6px 12px rgba(0,0,0,0.15), -6px -6px 12px rgba(255,255,255,0.8);
      color: #fff;
    }

    .highlight-btn:hover {
      transform: scale(1.05);
      box-shadow: 8px 8px 16px rgba(0,0,0,0.2), -8px -8px 16px rgba(255,255,255,0.9);
    }

    #finalPreview {
      max-width: 420px;
      margin-top: 25px;
      border-radius: 18px;
      box-shadow: 8px 8px 20px rgba(0,0,0,0.15), -8px -8px 20px rgba(255,255,255,0.8);
    }

    @media (max-width: 600px) {
      .photoPreview img { width: 120px; height: 90px; }
      .highlight-btn { padding: 14px 24px; font-size: 16px; }
      #countdown { font-size: 60px; }
    }
  </style>
</head>
<body>

  <h2>Amore Wedding Photobooth App</h2>

  <div class="card" id="templatePicker">
    <h4>1. PNG template ကိုရွေးပါ</h4>
    <img id="templatePreviewImg" src="./AungMayTemplate.png" alt="Default Template">
    
    <input type="file" id="templateUpload" accept="image/png" style="display: none;">
    <label for="templateUpload" style="display: block; margin-top: 10px; cursor: pointer;">
      သို့မဟုတ် သင့် template ကို upload လုပ်ပါ (2 × 6 အင်ချ်)
    </label>
  </div>

  <div class="card" id="cameraSection" style="display:none;">
    <h4>2. ကင်မရာ ရွေးချယ်ပါ</h4>
    <select id="cameraSelect"></select>

    <h4>3. ပုံရိုတ်ရန် (၂ ပုံ)</h4>
    <div id="videoWrapper">
      <video id="video" autoplay playsinline></video>
      <canvas id="overlayCanvas"></canvas>
      <div id="countdown"></div>
    </div>

    <div class="photoPreview" id="photoPreview">
      <img id="photo1Preview" style="display:none;">
      <img id="photo2Preview" style="display:none;">
    </div>

    <button id="takePhoto" class="highlight-btn">ပုံရိုတ်မည်</button>
    <button id="uploadPhoto">Or ပုံရွေးတင်မည်</button>
    <button id="generateFinal" class="highlight-btn" style="display:none;">Final ပုံထုတ်မည်</button>

    <canvas id="canvas" style="display:none;"></canvas>

    <p style="margin-top: 20px; font-size: 16px; color: #666;">
      ဆိုရှယ်မီဒီယာပေါ်တွင် #AungMay112225_amorewedding ကို သုံးပြီး မျှဝေပေးပါ။
    </p>
  </div>

  <div class="card" id="finalSection" style="display:none;">
    <h4>Final Image</h4>
    <img id="finalPreview" style="display:none;">
    <br>
    <a id="downloadLink" style="display:none;" download="final_wedding_photo.png">
      <button class="highlight-btn">Download ပုံ</button>
    </a>
  </div>

  <script>
    let selectedTemplate = './AungMayTemplate.png';
    let photos = [];

    const templateUpload = document.getElementById('templateUpload');
    const templatePreviewImg = document.getElementById('templatePreviewImg');
    const takePhotoBtn = document.getElementById('takePhoto');
    const generateFinalBtn = document.getElementById('generateFinal');
    const cameraSelect = document.getElementById('cameraSelect');
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const countdownEl = document.getElementById('countdown');
    const overlayCanvas = document.getElementById('overlayCanvas');
    const finalPreview = document.getElementById('finalPreview');
    const downloadLink = document.getElementById('downloadLink');
    const cameraSection = document.getElementById('cameraSection');
    const finalSection = document.getElementById('finalSection');

    // Load cameras
    async function loadCameras() {
      const devices = await navigator.mediaDevices.enumerateDevices();
      const videoDevices = devices.filter(d => d.kind === 'videoinput');
      cameraSelect.innerHTML = '';
      videoDevices.forEach((d, i) => {
        const opt = document.createElement('option');
        opt.value = d.deviceId;
        opt.innerText = d.label || `Camera ${i+1}`;
        cameraSelect.appendChild(opt);
      });
      startCamera(cameraSelect.value);
    }

    async function startCamera(deviceId) {
      if (window.stream) window.stream.getTracks().forEach(t => t.stop());
      window.stream = await navigator.mediaDevices.getUserMedia({ video: { deviceId: { exact: deviceId } }});
      video.srcObject = window.stream;
    }

    templateUpload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const objectUrl = URL.createObjectURL(file);
      selectedTemplate = objectUrl;
      templatePreviewImg.src = objectUrl;
    });

    // Show camera section once template is ready
    window.addEventListener('DOMContentLoaded', () => {
      cameraSection.style.display = 'block';
      loadCameras();
    });

    takePhotoBtn.addEventListener('click', async () => {
      if (photos.length >= 2) {
        alert('Already took two photos');
        return;
      }
      await countdown(3);
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const dataUrl = canvas.toDataURL('image/png');
      const img = new Image();
      img.src = dataUrl;
      img.onload = () => {
        photos.push(img);
        document.getElementById('photo' + photos.length + 'Preview').src = dataUrl;
        document.getElementById('photo' + photos.length + 'Preview').style.display = 'block';
        if (photos.length === 2) {
          generateFinalBtn.style.display = 'inline-block';
        }
      };
    });

    function countdown(seconds) {
      return new Promise(resolve => {
        let current = seconds;
        const interval = setInterval(() => {
          countdownEl.innerText = current > 0 ? current : '';
          current--;
          if (current < 0) {
            clearInterval(interval);
            resolve();
          }
        }, 1000);
      });
    }

    generateFinalBtn.addEventListener('click', () => {
      if (!selectedTemplate) {
        alert('No template selected.');
        return;
      }
      if (photos.length < 2) {
        alert('Need two photos.');
        return;
      }

      const outCanvas = document.createElement('canvas');
      const outCtx = outCanvas.getContext('2d');
      const templateImg = new Image();
      templateImg.src = selectedTemplate;

      templateImg.onload = () => {
        outCanvas.width = templateImg.width;
        outCanvas.height = templateImg.height;

        // Example: draw both photos
        outCtx.drawImage(photos[0], 0, 0, outCanvas.width / 2, outCanvas.height / 2);
        outCtx.drawImage(photos[1], outCanvas.width / 2, 0, outCanvas.width / 2, outCanvas.height / 2);

        outCtx.drawImage(templateImg, 0, 0, templateImg.width, templateImg.height);

        const finalUrl = outCanvas.toDataURL('image/png');
        finalPreview.src = finalUrl;
        finalPreview.style.display = 'block';
        downloadLink.href = finalUrl;
        downloadLink.style.display = 'inline-block';
        finalSection.style.display = 'block';
      };
    });
  </script>

</body>
</html>