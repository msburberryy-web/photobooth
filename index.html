<!DOCTYPE html>

<html>
<head>
  <style>
    /* ===== Overall Stylish CSS ===== */

    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: linear-gradient(135deg, #fdf6f0, #ffeedd);
      padding: 20px;
      text-align: center;
      color: #333;
      min-height: 100vh;
      margin: 0;
    }

    h2 {
      margin-bottom: 20px;
      color: #c96c4c;
      font-size: 32px;
      text-shadow: 1px 1px 5px rgba(0,0,0,0.1);
    }

    .card {
      background: #f7f7f7;
      border-radius: 20px;
      box-shadow: 8px 8px 16px rgba(0,0,0,0.1),
                  -8px -8px 16px rgba(255,255,255,0.7);
      padding: 30px;
      margin: 20px auto;
      max-width: 520px;
      position: relative;
      transition: box-shadow 0.3s ease;
    }

    .card:hover {
      box-shadow: 12px 12px 24px rgba(0,0,0,0.15),
                  -12px -12px 24px rgba(255,255,255,0.8);
    }

    input[type="file"], select {
      padding: 14px;
      border-radius: 12px;
      border: none;
      background: #f0f0f0;
      box-shadow: inset 4px 4px 8px rgba(0,0,0,0.1),
                  inset -4px -4px 8px rgba(255,255,255,0.7);
      margin-top: 15px;
      width: 85%;
      font-size: 16px;
      outline: none;
      transition: box-shadow 0.3s ease;
    }

    input[type="file"]:hover, select:hover {
      box-shadow: inset 2px 2px 6px rgba(0,0,0,0.1),
                  inset -2px -2px 6px rgba(255,255,255,0.7);
    }

    #templatePreviewImg {
      max-width: 300px;
      border-radius: 15px;
      margin-top: 15px;
      box-shadow: 4px 4px 12px rgba(0,0,0,0.1),
                  -4px -4px 12px rgba(255,255,255,0.8);
    }

    #videoWrapper {
      position: relative;
      width: 100%;
      max-width: 480px;
      margin: 20px auto;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 8px 8px 20px rgba(0,0,0,0.15),
                  -8px -8px 20px rgba(255,255,255,0.8);
    }

    video, #overlayCanvas {
      width: 100%;
      height: auto;
      display: block;
      object-fit: cover;
    }

    #countdown {
      font-size: 72px;
      font-weight: bold;
      color: #ff4c4c;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      text-shadow: 2px 2px 10px rgba(0,0,0,0.3);
    }

    .photoPreview {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }

    .photoPreview img {
      width: 140px;
      height: 105px;
      object-fit: cover;
      border-radius: 12px;
      box-shadow: 4px 4px 12px rgba(0,0,0,0.1),
                  -4px -4px 12px rgba(255,255,255,0.8);
      transition: transform 0.3s;
    }

    .photoPreview img:hover {
      transform: scale(1.05);
    }

    button {
      padding: 16px 32px;
      font-size: 17px;
      border: none;
      border-radius: 18px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      /* gradient + soft shadow for modern call-to-action */
      background: linear-gradient(135deg, #c96c4c, #ff7f5f);
      box-shadow: 6px 6px 12px rgba(0,0,0,0.15),
                  -6px -6px 12px rgba(255,255,255,0.8);
      color: #fff;
    }

    button:hover {
      transform: scale(1.05);
      box-shadow: 8px 8px 16px rgba(0,0,0,0.2),
                  -8px -8px 16px rgba(255,255,255,0.9);
    }

    #finalPreview {
      max-width: 420px;
      margin-top: 25px;
      border-radius: 18px;
      box-shadow: 8px 8px 20px rgba(0,0,0,0.15),
                  -8px -8px 20px rgba(255,255,255,0.8);
    }

    @media (max-width: 600px) {
      .photoPreview img { width: 120px; height: 90px; }
      button { padding: 14px 24px; font-size: 16px; }
      #countdown { font-size: 60px; }
    }

  </style>
</head>
<body>

<h2>Amore Wedding Photobooth App</h2>

<div id="templatePicker">
  <h4>1. PNG template ကို Upload လုပ်ပါ</h4>
    <img
    id="templatePreviewImg"
    src="./AungMayTemplate.png"
    alt="Default Template"
    style="max-width:300px; border: 2px solid #ccc; border-radius: 12px;"
    >
    <input
      type="file"
      id="templateUpload"
      accept="image/png"
      style="display: none;"
    >
    <label for="templateUpload" style="display: block; margin-top: 10px;">
    Or upload a different template(2 x 6 inches)
    </label>
    <br>
    <img id="templatePreview" style="display:none;">
</div>

<div class="card" id="cameraSection" style="display:none;">
    <h4>2. Choose Camera</h4>
    <select id="cameraSelect"></select>

```
<h4>3. ပုံရိုက်ရန် (Default = 2 pics)</h4>
<div id="videoWrapper">
    <video id="video" autoplay playsinline></video>
    <canvas id="overlayCanvas"></canvas>
    <div id="countdown"></div>
</div>

<div class="photoPreview" id="photoPreview">
    <img id="photo1Preview" style="display:none;">
    <img id="photo2Preview" style="display:none;">
</div>

<button id="takePhoto" class="highlight-btn">ပုံရိုက်မည်</button>
<button id="uploadPhoto">Or ပုံရွေးတင်မည်</button>
<button id="generateFinal" class="highlight-btn" style="display:none;">Final Image ကိုထုတ်မည်</button>

<canvas id="canvas" style="display:none;"></canvas>
<p style="margin-top: 20px; font-size: 16px; color: #666;">
    ဆိုရှယ်မီဒီယာတွေအပေါ်မှာ #AungMay112225_amorewedding သုံးပြီးမျှဝေနိုင်ပါတယ်
</p>

</div>

<div class="card">
    <h4>Final Image</h4>
    <img id="finalPreview" style="display:none;">
    <br>
    <a id="downloadLink" style="display:none;" download="final_wedding_photo.png">
        <button>Download Final Image</button>
    </a>
</div>

<script>
  // ==== Variables / State ====
  let selectedTemplate = './AungMayTemplate.png';  // default template path
  let photos = [];  // store captured photos (Image objects or data URL)

  // DOM elements
  const templateUpload = document.getElementById('templateUpload');
  const templatePreviewImg = document.getElementById('templatePreviewImg');
  const takePhotoBtn = document.getElementById('takePhoto');
  const generateFinalBtn = document.getElementById('generateFinal');
  const video = document.getElementById('video');
  const canvas = document.getElementById('canvas');
  const countdownEl = document.getElementById('countdown');

  // ==== Functions ====

  /**
   * Handle template upload by user.
   * Converts file to a blob URL and updates preview + selectedTemplate.
   */
  templateUpload.addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (!file) return;

    const objectUrl = URL.createObjectURL(file);  // create blob URL :contentReference[oaicite:1]{index=1}
    selectedTemplate = objectUrl;
    templatePreviewImg.src = objectUrl;

    // Optionally: revoke the object URL later to avoid memory leak :contentReference[oaicite:2]{index=2}
    // URL.revokeObjectURL(objectUrl);
  });

  /**
   * Called when “Take Photo” button is clicked.
   * Starts countdown, captures a frame, and stores it.
   */
  takePhotoBtn.addEventListener('click', async () => {
    // Example: only allow 2 photos
    if (photos.length >= 2) {
      alert("Already took two photos");
      return;
    }

    // Countdown logic
    await countdown(3);

    // Capture the frame from video into canvas
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    // Convert canvas to data URL and store as image
    const dataUrl = canvas.toDataURL('image/png');
    const img = new Image();
    img.src = dataUrl;
    img.onload = () => {
      photos.push(img);

      // If you want, you can immediately enable “Generate Final” when you have enough photos
      if (photos.length === 2) {
        generateFinalBtn.style.display = 'inline-block';
      }
    };
  });

  /**
   * Countdown timer that updates countdownEl.
   * @param {number} seconds - how many seconds to count down
   */
  function countdown(seconds) {
    return new Promise((resolve) => {
      let current = seconds;
      const interval = setInterval(() => {
        countdownEl.innerText = current > 0 ? current : '';
        current--;
        if (current < 0) {
          clearInterval(interval);
          resolve();
        }
      }, 1000);
    });
  }

  /**
   * Merge the taken photos with the selected template.
   * (This is a simplified version — adapt to your template / positioning logic.)
   */
  generateFinalBtn.addEventListener('click', () => {
    if (!selectedTemplate) {
      return alert("No template selected.");
    }
    if (photos.length < 2) {
      return alert("Need two photos.");
    }

    const outCanvas = document.createElement('canvas');
    const outCtx = outCanvas.getContext('2d');

    // Load the selected template image
    const templateImg = new Image();
    templateImg.src = selectedTemplate;

    templateImg.onload = () => {
      // Set canvas size to template size
      outCanvas.width = templateImg.width;
      outCanvas.height = templateImg.height;

      // Example: draw photos — you’ll need real positioning logic
      // Here we just draw photo[0] and photo[1] somewhere
      outCtx.drawImage(photos[0], 0, 0, outCanvas.width / 2, outCanvas.height / 2);
      outCtx.drawImage(photos[1], outCanvas.width / 2, 0, outCanvas.width / 2, outCanvas.height / 2);

      // Then draw the template on top
      outCtx.drawImage(templateImg, 0, 0);

      const finalUrl = outCanvas.toDataURL('image/png');
      // Show finalUrl in an <img>, or provide download link, etc.
      const finalImgEl = document.getElementById('finalPreview');
      finalImgEl.src = finalUrl;
      finalImgEl.style.display = 'block';

      const downloadLink = document.getElementById('downloadLink');
      downloadLink.href = finalUrl;
      downloadLink.style.display = 'inline-block';
    };
  });

</script>

</body>
</html>
